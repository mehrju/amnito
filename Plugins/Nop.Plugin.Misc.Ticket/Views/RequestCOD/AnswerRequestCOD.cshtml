@model Nop.Plugin.Misc.Ticket.Models.VmDetailRequestCOD
@using System.Net
@using Nop.Core
@inject IWebHelper webHelper
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@addTagHelper *, Nop.Web.Framework
@inject Nop.Core.Domain.Common.AdminAreaSettings adminAreaSettings
@using Nop.Web.Framework.UI
@inherits Nop.Web.Framework.Mvc.Razor.NopRazorPage<TModel>
@{
    Layout = "_AdminLayout";
    Html.AddCssFileParts(ResourceLocation.Footer, "~/Plugins/Misc.Ticket/Scripts/Select2/dist/css/select2.min.css");
    Html.AddScriptParts(ResourceLocation.Footer, "~/Plugins/Misc.Ticket/Scripts/Select2/dist/js/select2.full.min.js");
    Html.AddScriptParts(ResourceLocation.Footer, "~/Plugins/Orders.MultiShipping/Content/common.js");
}


<div class="content-header clearfix">
    <h1 class="pull-left">
        اطلاعات فروشگاه
    </h1>

</div>
<div class="content">
    <div class="panel panel-default panel-search">
        <div class="panel-body">
            <div class="form-horizontal codform">
                <div class="row">
                    <input type="hidden" id="tempStateName" name="tempStateName" value="@(Model.Tbl_RequestCODCustomer.CityId)" />
                    <input type="hidden" id="Id" name="Id" value="@(Model.Tbl_RequestCODCustomer.Id)" />
                    <div class="col-12 col-xl-12 col-lg-12 col-sm-12">
                        <a href="https://postex.ir/admin/order/edit/@(Model.Tbl_RequestCODCustomer.OrderId)" target="_blank">==&gt;مشاهده پرداختی برای درخواست پسکرایه&lt;==</a>
                    </div>
                    <div class="col-12 col-xl-6 col-lg-6 col-sm-6">
                        <label>نام<span style="color:red">*</span></label>
                        <div>
                            <input id="Fname" name="Fname" value="@(Model.Tbl_RequestCODCustomer.Fname)" persianName="نام" type="text" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>

                    <div class="col-12 col-xl-6 col-lg-6 col-sm-6 mt-sm-0">
                        <label>نام خانوادگی<span style="color:red">*</span></label>
                        <div>
                            <input id="Lname" name="Lname" value="@(Model.Tbl_RequestCODCustomer.Lname)" persianName="نام خانوادگی" type="text" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12">
                        <label>تلفن ثابت<span style="color:red">*</span></label>
                        <div>
                            <input id="Phone" name="Phone" persianName="تلفن ثابت" value="@(Model.Tbl_RequestCODCustomer.Phone)" type="text" maxlength="13" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>
                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12">
                        <label>کد پستی<span style="color:red">*</span></label>
                        <div>
                            <input id="PostalCode" name="CodePosti" value="@(Model.Tbl_RequestCODCustomer.CodePosti)" type="text" required class="form-control selectInput" maxlength="10" persianName="کد پستی" style="padding: 12px;" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))">
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12 mt-sm-0 mb-3">
                        <label>کد ملی/شناسه ملی<span style="color:red">*</span></label>
                        <div>
                            <input id="NationalCode" name="NatinolCode" value="@(Model.Tbl_RequestCODCustomer.NatinolCode)" persianName="کد ملی/شناسه ملی" type="text" maxlength="12" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>

                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12 mt-sm-0 mb-3">
                        <label>شماره سریال کارت ملی<span style="color:red">*</span></label>
                        <div>
                            <input id="ManagerNationalIDSerial" name="ManagerNationalIDSerial" value="@(Model.Tbl_RequestCODCustomer.ManagerNationalIDSerial)" persianName="شماره سریال کارت ملی" maxlength="20" type="text" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12">
                        <label>تاریخ تولد<span style="color:red">*</span></label>
                        <div>
                            <input id="ManagerBirthDate" name="ManagerBirthDate" persianName="تاریخ تولد" value="@(Model.Tbl_RequestCODCustomer.ManagerBirthDate)" maxlength="10" type="text" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>
                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12">
                        <label>موبایل<span style="color:red">*</span></label>
                        <div>
                            <input id="Mobile" name="Mobile" persianName="موبایل" type="text" maxlength="12" required value="@(Model.Tbl_RequestCODCustomer.Mobile)"
                                   class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12">
                        <label>ایمیل<span style="color:red">*</span></label>
                        <div>
                            <input id="Email" name="Email" persianName="ایمیل" value="@(Model.Tbl_RequestCODCustomer.Email)"
                                   type="text" maxlength="100" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>
                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12">
                        <label>شماره حساب<span style="color:red">*</span></label>
                        <div>
                            <input id="AccountNumber" name="AccountNumber" maxlength="30" value="@(Model.Tbl_RequestCODCustomer.AccountNumber)" persianName="شماره حساب" type="text" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12">
                        <label>شماره شبا<span style="color:red">*</span></label>
                        <div>
                            <input id="AccountIBAN" name="Shaba" pattern="^(?:IR)(?=.{24}$)[0-9]*$" value="@(Model.Tbl_RequestCODCustomer.Shaba)" persianName="شماره شبا" type="text" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>
                    <div class=" col-xl-6 col-lg-6 col-sm-12 col-12">
                        <label>نام شعبه بانک<span style="color:red">*</span></label>
                        <div>
                            <input id="AccountBranchName" name="AccountBranchName" persianName="نام شعبه بانک" maxlength="50" value="@(Model.Tbl_RequestCODCustomer.AccountBranchName)" type="text" required class="form-control selectInput" style="padding: 12px;">
                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12 mb-2">
                        <label>استان :</label>
                        <select class="form-control selectInput preOrderInput w-100" persianName="استان" required defaultVal="انتخاب استان" name="StateId" id="Country"></select>

                    </div>

                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12 mb-2">
                        <label>شهرستان :</label>
                        <select class="form-control selectInput preOrderInput w-100" required persianName="شهرستان" name="CityId" id="State"></select>
                    </div>
                </div>

                <div class="row">
                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 mb-2">
                        <label> آدرس<span style="color:red">*</span></label>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 mb-2">
                            <textarea id="Address" name="Address" persianName="آدرس"
                                      class="form-control" maxlength="400" required aria-label="With textarea">@(Model.Tbl_RequestCODCustomer.Address.Trim())</textarea>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12 mb-2">
                        <label> توضیحات<span style="color:red">*</span></label>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 mb-2">
                            <textarea id="DesAnswerStaff" name="DesAnswerStaff" persianName="توضیحات"
                                      class="form-control" maxlength="400" required aria-label="With textarea">@(Model.Tbl_RequestCODCustomer.DesAnswerStaff?.Trim())</textarea>
                        </div>
                    </div>
                     <div class="col-xl-6 col-lg-6 col-md-6 col-sm-6 col-12 mb-2">
                         <label> پایان اعتبار<span style="color:red">*</span></label>
                        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 mb-2">
                            <nop-editor asp-for="EndDate" />
                        </div>
                    </div>
                </div>
                <hr />
                <div class="row" style="text-align:center">
                    <button id="BtnConfirm" class="btn btn-success">
                        تایید
                        <i class="fa fa-edit"></i>
                    </button>
                    <button id="BtnDisAgree" class="btn btn-danger">
                        عدم تایید
                        <i class="fa fa-ban"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<input id="tempStateName" type="hidden" />
<script>
    $(document).ready(function(){
        $('#BtnConfirm').click(function(){
            submitData(true);
        });
        $('#BtnDisAgree').click(function(){
            submitData(false);
        });
        function submitData(isConfirm)
        {
            var data={};
            $('.codform').find('input,select,textarea').each(function(){
                var name=$(this).attr('name');
                var value=$(this).val();
                data[name]=value;
            });
             addAntiForgeryToken(data);

            $.ajax({
            cache: true,
            type: "POST",
            url: isConfirm?  "@(Url.Action("ConfrimRequestCod", "ManageRequestCOD"))": "@(Url.Action("DisAgreeRequestCod", "ManageRequestCOD"))",
            data: data,
            success: function (data) {
               alert(data.message);
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log("Errro in save request cod");
            }
        });
        }
          document.getElementById('AccountNumber').addEventListener('input', event =>
            event.target.value = ToJsutNumber(event.target.value)
        );
        document.getElementById('Mobile').addEventListener('input', event =>
            event.target.value = ToJsutNumber(event.target.value)
        );
        document.getElementById('NationalCode').addEventListener('input', event =>
            event.target.value = ToJsutNumber(event.target.value)
        );
        document.getElementById('PostalCode').addEventListener('input', event =>
            event.target.value = ToJsutNumber(event.target.value)
        );
        document.getElementById('Phone').addEventListener('input', event =>
            event.target.value = ToJsutNumber(event.target.value)
        );

        $('#Country').change(function(){
            onCountryChange();
        });
        $.ajax({
            cache: true,
            type: "GET",
            url: "/ShipitoCheckout/getCountryList",
            data: {},
            success: function (data) {
                var $Country = $('#Country');
                $Country.append(new Option('استان را انتخاب کنید', '0', true, true));
                $.each(data, function (id, item) {
                    $Country.append(new Option(item.Text, item.Value, false, false));
                });

                $Country.val('@(Model.Tbl_RequestCODCustomer.StateId)').trigger('change');
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log('Failed to retrieve Countries.');
            }
        });

    });
      function onCountryChange() {
            var selectedItem =  $('#Country').val();
            var ddlStates = $('#State');
            ddlStates.html('');

            ddlStates.append(new Option('درحال بارگذاری....', '-1', true, true));
            $.ajax({
                beforeSend: function () {
                    $('.ajaxBusy').show();
                },
                complete: function () {
                    $('.ajaxBusy').hide();
                },
                cache: false,
                type: "GET",
                url: "/ShipitoCheckout/GetStatesByCountryId" ,
                data: { "countryId": selectedItem, "isCod": "false"},
                success: function (reuslt) {
                    ddlStates.html('');
                    ddlStates.append(new Option('انتخاب کنید....', '0', true, true));
                    $.each(reuslt, function (id, item) {
                        ddlStates.append(new Option(item.Text, item.Value, false, false));
                    });
                    debugger;
                    if ($('#tempStateName').val() != '') {
                        $('#State').val($('#tempStateName').val()).trigger('change');
                        $('#tempStateName').val('');
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    console.log('Failed to retrieve states.');
                }
            });
        }

</script>
